<!DOCTYPE html>
<html>
	<head>

			<!-- Latest compiled and minified CSS -->
			<link rel="stylesheet" href="/css/bootstrap.min.css">
			<!-- Optional theme -->
			<link rel="stylesheet" href="/css/bootstrap-theme.min.css">
			<link rel="stylesheet" href="/css/common.css">
			<!-- Jquery -->
			<script src="http://code.jquery.com/jquery-1.11.3.min.js"></script>
			<!-- Latest compiled and minified JavaScript -->
			<script src="/js/bootstrap.min.js"></script>

			<script src="/js/Chart.js"></script>
            {% if revenue != null %}
                <script>
                    var randomScalingFactor = function(){ return {{ maxValue }} };
                    var barChartData = {
                        labels : ["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"],
                        datasets : [
                            {
                                fillColor : "rgba(151,187,205,0.5)",
                                strokeColor : "rgba(151,187,205,0.8)",
                                highlightFill : "rgba(151,187,205,0.75)",
                                highlightStroke : "rgba(151,187,205,1)",
                                data : [
                                        {% for cant in revenue %}
                                            {{ cant }},
                                        {% endfor %}
                                        ]
                            }
                        ]
                    }
                    window.onload = function()
                    {
                        var ctx = document.getElementById("estadisticas").getContext("2d");

                        window.myBar = new Chart(ctx).Bar(barChartData,
                                {
                                    responsive : true
                                });
                    }
                </script>

                <script src="http://mrrio.github.io/jsPDF/dist/jspdf.debug.js"></script>

                <script type="text/javascript">

                    function saveAsPDF()
                    {

                        var pdf = new jsPDF('portrait', 'pt', 'a4');
                        // source can be HTML-formatted string, or a reference
                        // to an actual DOM element from which the text will be scraped.
                        source = $('#container')[0];

                        // we support special element handlers. Register them with jQuery-style
                        // ID selector for either ID or node name. ("#iAmID", "div", "span" etc.)
                        // There is no support for any other type of selectors
                        // (class, of compound) at this time.
                        specialElementHandlers = {
                            // element with id of "bypass" - jQuery style selector
                            '#bypassme': function (element, renderer) {
                                // true = "handled elsewhere, bypass text extraction"
                                return true
                            }
                        };
                        margins = {
                            top: 80,
                            bottom: 60,
                            left: 40,
                            width: 522
                        };
                        // all coords and widths are in jsPDF instance's declared units
                        // 'inches' in this case
                        pdf.fromHTML(
                                source, // HTML string or DOM elem ref.
                                margins.left, // x coord
                                margins.top, { // y coord
                                    'width': margins.width, // max width of content on PDF
                                    'elementHandlers': specialElementHandlers
                                },

                                function (dispose) {
                                    // dispose: object with X, Y of the last line add to the PDF
                                    //          this allow the insertion of new lines after html
                                    var canvas = document.getElementById("estadisticas");
                                    var imgData = canvas.toDataURL("image/jpeg",1.0);

                                    pdf.addImage(imgData, 'JPEG', 5, 200,canvas.width/2,canvas.height/2);
                                    pdf.save('document.pdf');
                                }, margins);
                    }

                </script>
            {% endif %}
			<title> listado </title>

	</head>
	<body>
		<div class="container" id="container">
			<h1 class="page-header">
                {% if year == null %}
				    Ingresos por year
                {% else %}
                    Ingresos del year {{ year }}
                {% endif %}
			</h1>
            <form method="POST" action="/listRevenueAction">
                <label>Seleccione el year</label>
                <input type="number" name="year" required >

                <input type="submit" name="enviar" value="Enviar">
            </form>


			<canvas id="estadisticas" width="400" height="150"></canvas>


		</div> <!-- /container -->
        <button onclick="javascript:saveAsPDF();">Save as PDF</button>
	</body>
</html>


