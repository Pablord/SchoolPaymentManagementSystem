{% extends '/common/base.html.twig' %}

{% block title %}Mapa{% endblock %}

{% block head %}


    <link rel="stylesheet" href="http://openlayers.org/en/v3.10.1/css/ol.css" type="text/css">
    <style>
        .map {
            height: 600px;
            width: 100%;
        }
    </style>
    <script src="http://openlayers.org/en/v3.10.1/build/ol.js" type="text/javascript"></script>
    {{ parent() }}
{% endblock %}

{% block body %}
    {{ parent() }}

    <div class="container" id="container">
        <h1>holis</h1>
        <div id="map" class="map"></div>

        <label class="checkbox" for="track">
            <input id="track" type="checkbox">track position </input>
        </label>
        <script type="text/javascript">



            var view = new ol.View({
                center: ol.proj.transform([-57.9749, -34.9205], 'EPSG:4326', 'EPSG:3857'),
                zoom: 13

            });


            var map = new ol.Map({
                target: 'map',
                layers: [
                    new ol.layer.Tile({
                        source: new ol.source.MapQuest({layer: 'osm'})
                    })
                ],
                view: view
            });



            document.getElementById('track').addEventListener('change', function() {
                geolocation.setTracking(this.checked);
            });

            var geolocation = new ol.Geolocation({
                projection: view.getProjection()
            });

            var positionFeature = new ol.Feature();

            positionFeature.setStyle(new ol.style.Style({
                image: new ol.style.Circle({
                    radius: 6,
                    fill: new ol.style.Fill({
                        color: '#3399CC'
                    }),
                    stroke: new ol.style.Stroke({
                        color: '#fff',
                        width: 2
                    })
                })
            }));

            var positionFeatureX = new ol.Feature();

            positionFeatureX.setStyle(new ol.style.Style({
                image: new ol.style.Circle({
                    radius: 6,
                    fill: new ol.style.Fill({
                        color: '#3399CC'
                    }),
                    stroke: new ol.style.Stroke({
                        color: '#fff',
                        width: 2
                    })
                })
            }));

            geolocation.on('change:position', function() {
                var coordinates = geolocation.getPosition();
                positionFeature.setGeometry(coordinates ? new ol.geom.Point(coordinates) : null);
                positionFeatureX.setGeometry(new ol.geom.Point([-6455361.423378526, -4153081.947043341]))
            });

            geolocation.on('change', function(evt) {
                window.console.log(geolocation.getPosition());
                window.console.log(ol.proj.transform([-57.9749, -34.9205], 'EPSG:4326',   'EPSG:3857'));
            });
            var featuresOverlay = new ol.layer.Vector({
                map: map,
                source: new ol.source.Vector({
                    features: [ positionFeature, positionFeatureX ]
                })
            });


        </script>
    </div>


{% endblock %}
